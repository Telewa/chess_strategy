pipeline {
	agent any
	stages {
        stage('Build Backend') {
            steps {
                sh 'docker build -t chesser-backend:1.0.0 backend/chesser'
            }
        }

        stage('Sanity Check') {
            steps {
                sh 'docker images | grep chesser-backend'
            }
        }

        stage('Tag the image!') {
            steps {
                sh 'docker tag chesser-backend:1.0.0 759850685393.dkr.ecr.us-west-2.amazonaws.com/chesser-backend:1.0.0'
            }
        }

        stage('Push the image!') {
            steps {
                sh '$(aws ecr get-login --no-include-email --region us-west-2)'
                sh 'docker push 759850685393.dkr.ecr.us-west-2.amazonaws.com/chesser-backend:1.0.0'
            }
        }
    }
}