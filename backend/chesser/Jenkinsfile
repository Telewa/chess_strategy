pipeline {
    environment {
        registry = "emmanueltelewa/chesser"
        registryCredential = 'dockerhub'
    }
	agent any
	stages {
        stage('Build Frontend') {
            steps {
                sh 'docker build -t chesser-backend-1-0-0 backend'
            }
        }

        stage('Sanity Check') {
            steps {
                sh 'docker images | grep chesser-backend'
            }
        }

        stage('Tag the image!') {
            steps {
                sh 'docker tag chesser-backend-1-0-0 emmanueltelewa/chesser:chesser-backend-1-0-0'
            }
        }

        stage('cleanup docker images') {
            steps {
                sh 'docker system prune -f'
            }
        }

        stage('Push the image to dockerhub!') {
            steps {
                script {
                    docker.withRegistry( '', registryCredential ) {
                        sh 'docker push emmanueltelewa/chesser:chesser-backend-1-0-0'
                    }
                }
            }
        }

    }
}